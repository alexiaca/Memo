/**
 * grrd's Memo
 * Copyright (c) 2020 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";let e=0;const t=[{desc:"grrd’s Memo is a HTML5 Game that works offline.",help:"Flip the cards and find the pairs. Is your memory good enough to remember?",themes_txt:["Animals","Flowers","Masha"],cards:"Cards",player:"Player",players:"Players",start:"Play",dev:"Developed by Gérard Tyedmers.",look:"Have a look at my other games:",begin:"begins.",has:"has now",and:"and",win:"wins with",win2:"win with",pair:"pair",pairs:"pairs",pairs2:"pairs",tries:"tries",rank:"rank",stats:"lCards pairs revealed in lTries attempts.",turn:"lPlayer 's turn."},{desc:"grrd's Memo ist ein HTML5 Spiel, welches offline funktioniert",help:"Dreh die Karten um und finde die Paare. Ist dein Gedächtnis gut genug?",themes_txt:["Tiere","Blumen","Mascha"],cards:"Karten",player:"Spieler",players:"Spieler",start:"Start",dev:"Entwickelt von Gérard Tyedmers.",look:"Schau dir auch meine anderen Spiele an: ",begin:"beginnt.",has:"hat nun",and:"und",win:"gewinnt mit",win2:"gewinnen mit",pair:"Paar",pairs:"Paare",pairs2:"Paaren",tries:"Versuche",rank:"Rang",stats:"lCards Paare in lTries Versuchen aufgedeckt.",turn:"lPlayer ist am Zug."},{desc:"grrd's Memo est un jeu en HTML5 qui fonctionne hors ligne.",help:"Retournez les cartes et trouvez les paires. Votre mémoire est-elle assez bonne?",themes_txt:["Animaux","Fleurs","Mascha"],cards:"Cartes",player:"Joueur",players:"Joueurs",start:"Jouer",dev:"Développé par Gérard Tyedmers.",look:"Regardez aussi mes autres jeux: ",begin:"commence.",has:"a maintenant",and:"et",win:"gagne avec",win2:"gagnent avec",pair:"paire",pairs:"paires",pairs2:"paires",tries:"Essais",rank:"Rang",stats:"lCards paires révélées en lTries essais.",turn:"Au tour du lPlayer."},{desc:"grrd's Memo es un juego HTML5 que funciona fuera de línea.",help:"Voltea las cartas y encuentra los pares. ¿Es tu memoria lo suficientemente buena?",themes_txt:["Animales","Flores","Masha"],cards:"Cartas",player:"Jugador",players:"Jugadores",start:"Juega",dev:"Desarrollado por Gérard Tyedmers.",look:"Echa un vistazo a mis otros juegos:",begin:"comienza.",has:"tiene ahora",and:"y",win:"gana con",win2:"ganan con",pair:"par",pairs:"pares",pairs2:"pares",tries:"intentos",rank:"rango",stats:"lCards pares revelados en lTries intentos.",turn:"Turno del lPlayer"}],n=function(e){return document.getElementById(e)},s=n("iPopupInfo"),r=n("iPopupScore"),a=n("iTitle"),i=n("iGame"),l=n("tScore"),o=n("lDev"),c=n("iFullscreen"),d=document.getElementsByClassName("title2card"),u=n("grid");let m;const p=u.getElementsByClassName("flip-container");let g,h=[],f=24;const L=["animals","flowers","mascha"];let y=0,E=0,v=-1;const w=[6,12,24,32,48];let T,M=2,k=2,C=[],b=[],H=[];const S=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function F(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?n("img_fullscreen").src="images/escfullscreen.svg":n("img_fullscreen").src="images/fullscreen.svg"}function N(e){for(g=e.length-1;g>0;g-=1){const t=Math.floor(Math.random()*(g+1));[e[g],e[t]]=[e[t],e[g]]}return e}function P(){s.classList.remove("popup-init"),s.classList.remove("popup-hide"),s.classList.add("popup-show")}function B(){s.classList.remove("popup-show"),s.classList.add("popup-hide")}function x(){3===(E+=1)&&(v=0,S&&localStorage.setItem("s_mascha","true"))}function A(s){let r=parseInt(s.target.getAttribute("data-step"));y+r>=0&&y+r<L.length+v&&(y+=r,n("lTheme").innerHTML=t[e].themes_txt[y],n("iTheme").src="images/"+L[y]+".svg")}function z(s){let r=parseInt(s.target.getAttribute("data-step"));M+r>=0&&M+r<w.length&&(M+=r,n("lCards").innerHTML=w[M]+" "+t[e].cards,n("iCards").src="images/cards"+w[M]+".svg")}function I(s){let r=parseInt(s.target.getAttribute("data-step"));k+r>0&&k+r<6&&(k+=r,n("iPlayers").src="images/player"+k+".svg",n("lPlayers").innerHTML=1===k?k+" "+t[e].player:k+" "+t[e].players)}function q(){let e=.7*Math.sqrt((document.documentElement.clientHeight-40)*document.documentElement.clientWidth/w[M]);u.setAttribute("style","grid-template-columns: repeat(auto-fill, minmax("+e+"px, 1fr))"),document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: wrap;"),n("iStart").getBoundingClientRect().bottom>window.innerHeight&&document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: nowrap;")}function R(s){return function(){!function(s){if(s.classList.contains("turned"))2===h.length&&h.includes(s)&&(h[0].classList.remove("turned"),h[1].classList.remove("turned"),h=[]);else if(2===h.length&&(h[0].classList.remove("turned"),h[1].classList.remove("turned"),h=[]),h.push(s),b[T]+=1,2===h.length&&(h[0].getElementsByClassName("image")[0].src===h[1].getElementsByClassName("image")[0].src?(C[T]+=1,1===C[T]?n("iMessage").innerHTML=t[e].player+" "+(T+1)+" "+t[e].has+" "+C[T]+" "+t[e].pair+".":n("iMessage").innerHTML=t[e].player+" "+(T+1)+" "+t[e].has+" "+C[T]+" "+t[e].pairs+".",h=[]):((T+=1)===k&&(T=0),n("iMessage").innerHTML=t[e].turn.replace("lPlayer",t[e].player+" "+(T+1)))),s.classList.toggle("turned"),u.getElementsByClassName("turned").length===w[M]){if(1===k)l.classList.add("hidden"),n("lWinner").innerHTML=t[e].stats.replace("lCards",w[M]/2).replace("lTries",b[0]/2);else{const s=document.createElement("tbody");let r,a,i,o="";for(l.classList.remove("hidden"),H=[],l.replaceChild(s,l.getElementsByTagName("tbody")[0]),g=0;g<k;g+=1)H.push({player:g+1,pairs:C[g],tries:b[g]/2});for(H.sort((e,t)=>t.pairs-e.pairs||e.tries-t.tries),g=0;g<k;g+=1)H[g].rank=g+1,g>0&&H[g-1].pairs===H[g].pairs&&(H[g].rank=H[g-1].rank),1===H[g].rank&&(o+=", "+H[g].player),(a=(r=s.insertRow()).insertCell(0)).innerHTML=H[g].rank,(a=r.insertCell(1)).innerHTML=t[e].player+" "+H[g].player,(a=r.insertCell(2)).innerHTML=H[g].pairs,(a=r.insertCell(3)).innerHTML=H[g].tries;(i=o.lastIndexOf(","))>0?(o=o.substring(2,i)+" "+t[e].and+o.substring(i+1),n("lWinner").innerHTML=t[e].players+" "+o+" "+t[e].win2+" "+H[0].pairs+" "+t[e].pairs2+"."):n("lWinner").innerHTML=t[e].player+" "+H[0].player+" "+t[e].win+" "+H[0].pairs+" "+t[e].pairs2+"."}r.classList.remove("popup-init"),r.classList.remove("popup-hide"),r.classList.add("popup-show")}}(s)}}function _(){let s=[],r=[];for(u.innerHTML="",C=new Array(k).fill(0),b=new Array(k).fill(0),T=0,h=[],n("iMessage").innerHTML=t[e].player+" 1 "+t[e].begin,g=0;g<f;g+=1)s.push(g+1);for(N(s),g=0;g<w[M]/2;g+=1)r.push(s[g]),r.push(s[g]);for(N(r),g=0;g<w[M];g+=1)(m=n("iDummy").getElementsByClassName("flip-container")[0].cloneNode(!0)).getElementsByClassName("image")[0].src="images/"+L[y]+"/"+r[g]+".jpg",u.appendChild(m);for(g=0;g<p.length;g+=1)p[g].onclick=R(p[g]);q(),a.classList.remove("swipe-out-right"),i.classList.remove("swipe-in-left"),a.classList.add("swipe-out"),i.classList.add("swipe-in")}function D(){a.classList.remove("swipe-out"),i.classList.remove("swipe-in"),a.classList.add("swipe-out-right"),i.classList.add("swipe-in-left")}function W(){r.classList.remove("popup-show"),r.classList.add("popup-hide"),setTimeout(function(){D()},600)}function G(e){let t=new URLSearchParams(window.location.search);return!!t.has(e)&&t.get(e)}window.addEventListener("resize",function(){q()}),document.addEventListener("fullscreenchange",function(){F()}),document.addEventListener("mozfullscreenchange",function(){F()}),document.addEventListener("webkitfullscreenchange",function(){F()}),document.addEventListener("msfullscreenchange",function(){F()}),function(){const s=(G("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();"de"===s?e=1:"fr"===s?e=2:"es"===s&&(e=3),e&&document.documentElement.setAttribute("lang",s),n("lTheme").innerHTML=t[e].themes_txt[y],n("lCards").innerHTML=w[M]+" "+t[e].cards,n("lPlayers").innerHTML=k+" "+t[e].players,n("lStart").innerHTML=t[e].start,o.innerHTML=t[e].dev,n("lInstr").innerHTML=t[e].help,n("lLook").innerHTML=t[e].look,n("thRank").innerHTML=t[e].rank,n("thPlayer").innerHTML=t[e].player,n("thPairs").innerHTML=t[e].pairs,n("thTries").innerHTML=t[e].tries,document.querySelector("meta[name='description']").setAttribute("content",t[e].desc),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),n("iInfo").addEventListener("click",P),n("iInfoClose").addEventListener("click",B),n("iNextTheme").addEventListener("click",A),n("iPrevTheme").addEventListener("click",A),n("iCardsUp").addEventListener("click",z),n("iCardsDown").addEventListener("click",z),n("iPlayersUp").addEventListener("click",I),n("iPlayersDown").addEventListener("click",I),n("iStart").addEventListener("click",_),n("iClose").addEventListener("click",D),n("iOK").addEventListener("click",W),o.addEventListener("click",x),c.addEventListener("click",function(){!function(){const e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,s=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?s.call(e):n.call(t)}()}),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&c.parentNode.removeChild(c),"true"===G("mascha")&&(E=2,x()),S&&"true"===localStorage.getItem("s_mascha")&&(v=0),document.querySelectorAll("tspan").forEach(function(e){e.innerHTML="grrd's Memo grrd's Memo grrd's Memo grrd's Memo grrd's Memo"}),document.querySelectorAll(".popup-head").forEach(function(e){e.appendChild(document.getElementsByClassName("title1")[0].cloneNode(!0)),e.appendChild(document.getElementsByClassName("title2")[0].cloneNode(!0))}),Array.from(d).forEach(function(e){var t;e.onclick=(t=e,function(){t.classList.toggle("turned")})}),document.querySelectorAll(".popup-head .title2card").forEach(function(e){e.classList.add("turned")}),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},500),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},1e3),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.remove("turned")},1700),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.remove("turned")},1900),setTimeout(function(){document.getElementsByClassName("cardM2")[0].classList.add("turned")},2500),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},3e3),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},3700),setTimeout(function(){document.getElementsByClassName("cardO")[0].classList.add("turned")},4300),q()}()}();