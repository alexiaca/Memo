/**
 * grrd's Memo
 * Copyright (c) 2020 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";let e=0;const t=[{code:"en",lang:"English",style:["Light mode","Dark mode","Automatic"],sound:["Sound: off","Sound: on"],desc:"grrd’s Memo is a HTML5 Game that works offline.",help:"Flip the cards and find the pairs. Is your memory good enough to remember?",themes_txt:["Own Images","Animals","Flowers","Masha"],cards:"Cards",player:"Player",players:"Players",start:"Play",dev:"Developed by Gérard Tyedmers.",look:"Have a look at my other games:",begin:"begins.",has:"has now",and:"and",win:"wins with",win2:"win with",pair:"pair",pairs:"pairs",pairs2:"pairs",tries:"tries",rank:"rank",stats:"lCards pairs revealed in lTries attempts.",turn:"lPlayer 's turn.",own:"Click on a card to choose your image.",ownanz:"lAnz images needed to start the game.",ownanz2:"lAnz more images needed to start the game.",ownanz3:"lAnz more image needed to start the game.",ownanz4:"Press Play to start the game.",cancel:"Cancel"},{code:"de",lang:"Deutsch",style:["Ansicht: Hell","Ansicht: Dunkel","Automatisch"],sound:["Ton: aus","Ton: an"],desc:"grrd's Memo ist ein HTML5 Spiel, welches offline funktioniert",help:"Dreh die Karten um und finde die Paare. Ist dein Gedächtnis gut genug?",themes_txt:["Eigene Bilder","Tiere","Blumen","Mascha"],cards:"Karten",player:"Spieler",players:"Spieler",start:"Play",dev:"Entwickelt von Gérard Tyedmers.",look:"Schau dir auch meine anderen Spiele an: ",begin:"beginnt.",has:"hat nun",and:"und",win:"gewinnt mit",win2:"gewinnen mit",pair:"Paar",pairs:"Paare",pairs2:"Paaren",tries:"Versuche",rank:"Rang",stats:"lCards Paare in lTries Versuchen aufgedeckt.",turn:"lPlayer ist am Zug.",own:"Klick auf eine Karte, um dein Bild zu wählen.",ownanz:"Wähle lAnz Bilder, um das Spiel zu beginnen.",ownanz2:"Wähle noch lAnz Bilder, um das Spiel zu beginnen.",ownanz3:"Wähle noch lAnz Bild, um das Spiel zu beginnen.",ownanz4:"Drücke auf Play, um das Spiel zu beginnen.",cancel:"Abbrechen"},{code:"fr",lang:"Français",style:["Mode claire","Mode sombre","Automatique"],sound:["Son: muet","Son: activé"],desc:"grrd's Memo est un jeu en HTML5 qui fonctionne hors ligne.",help:"Retournez les cartes et trouvez les paires. Votre mémoire est-elle assez bonne?",themes_txt:["Images personnelles","Animaux","Fleurs","Mascha"],cards:"Cartes",player:"Joueur",players:"Joueurs",start:"Play",dev:"Développé par Gérard Tyedmers.",look:"Regardez aussi mes autres jeux: ",begin:"commence.",has:"a maintenant",and:"et",win:"gagne avec",win2:"gagnent avec",pair:"paire",pairs:"paires",pairs2:"paires",tries:"Essais",rank:"Rang",stats:"lCards paires révélées en lTries essais.",turn:"Au tour du lPlayer.",own:"Cliquez sur une carte pour choisir votre image.",ownanz:"Sélectionnez lAnz images pour commencer le jeu.",ownanz2:"Sélectionnez lAnz autres images pour commencer le jeu.",ownanz3:"Sélectionnez lAnz autre image pour commencer le jeu.",ownanz4:"Appuyez sur la touche Play pour commencer le jeu.",cancel:"Annuler"},{code:"es",lang:"Español",style:["Modo de luz","Modo oscuro ","Automático"],sound:["Sonido: mudo","Sonido: en"],desc:"grrd's Memo es un juego HTML5 que funciona fuera de línea.",help:"Voltea las cartas y encuentra los pares. ¿Es tu memoria lo suficientemente buena?",themes_txt:["Imágenes personales","Animales","Flores","Masha"],cards:"Cartas",player:"Jugador",players:"Jugadores",start:"Play",dev:"Desarrollado por Gérard Tyedmers.",look:"Echa un vistazo a mis otros juegos:",begin:"comienza.",has:"tiene ahora",and:"y",win:"gana con",win2:"ganan con",pair:"par",pairs:"pares",pairs2:"pares",tries:"intentos",rank:"rango",stats:"lCards pares revelados en lTries intentos.",turn:"Turno del lPlayer",own:"Haz clic en una carta para elegir tu imagen.",ownanz:"Selecciona lAnz imágenes para iniciar el juego.",ownanz2:"Selecciona lAnz imágenes más para empezar el juego.",ownanz3:"Selecciona lAnz imagen más para empezar el juego.",ownanz4:"Pulsa Play para iniciar el juego.",cancel:"Cancelar"}],n=String.fromCharCode(160),a=function(e){return document.getElementById(e)},s=a("iPopupInfo"),i=a("iPopupSettings"),r=a("iPopupScore"),l=a("iTitle"),o=a("iGame"),c=a("tScore"),d=a("lDev"),A=a("iFullscreen"),m=a("iSettingsPlay"),u=document.getElementsByClassName("title2card"),g=a("grid");let p;const h=g.getElementsByClassName("flip-container");let f,L=[];const E=24,w=["photo","animals","flowers","mascha"];let y=1,v=0,M=-1;const T=[6,12,24,32,48];let S,B,k,I,z=2,C=2,b=[],Q=[],H=[],_=!1,P=1,N=1,F=["sound_off.svg","sound_on.svg"];const x=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function D(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?a("img_fullscreen").src="images/escfullscreen.svg":a("img_fullscreen").src="images/fullscreen.svg"}function G(){e&&document.documentElement.setAttribute("lang",t[e].code),a("lLang").innerHTML=t[e].lang,a("lStyle").innerHTML=t[e].style[P],a("lSound").innerHTML=t[e].sound[N],a("iSound").src="images/"+F[N],a("lTheme").innerHTML=t[e].themes_txt[y],a("lCards").innerHTML=T[z]+n+t[e].cards,a("lPlayers").innerHTML=C+n+t[e].players,a("lStart").innerHTML=t[e].start,d.innerHTML=t[e].dev,a("lInstr").innerHTML=t[e].help,a("lLook").innerHTML=t[e].look,a("thRank").innerHTML=t[e].rank,a("thPlayer").innerHTML=t[e].player,a("thPairs").innerHTML=t[e].pairs,a("thTries").innerHTML=t[e].tries,a("lOwnImg").innerHTML=t[e].own,a("lOwnImg2").innerHTML=t[e].themes_txt[0],document.querySelector("meta[name='description']").setAttribute("content",t[e].desc)}function R(){a("lStyle").innerHTML=t[e].style[P],0===P||2===P&&I?document.getElementsByTagName("body")[0].classList.add("light"):document.getElementsByTagName("body")[0].classList.remove("light")}function U(e){for(f=e.length-1;f>0;f-=1){const t=Math.floor(Math.random()*(f+1));[e[f],e[t]]=[e[t],e[f]]}return e}function O(){s.classList.remove("popup-init"),s.classList.remove("popup-hide"),s.classList.add("popup-show")}function j(){s.classList.remove("popup-show"),s.classList.add("popup-hide")}function W(){ne(),i.classList.remove("popup-init"),i.classList.remove("popup-hide"),i.classList.add("popup-show")}function q(){x&&(localStorage.setItem("s_memo_sound",N),localStorage.setItem("s_memo_style",P),localStorage.setItem("s_memo_lang",e)),i.classList.remove("popup-show"),i.classList.add("popup-hide"),setTimeout(function(){i.classList.remove("play")},1e3)}function K(){3===(v+=1)&&(M=0,x&&localStorage.setItem("s_memo_mascha","true"))}function Y(n){let a=parseInt(n.target.getAttribute("data-step"));(e+=a)<0?e=t.length-1:e>t.length-1&&(e=0),G()}function V(e){let t=parseInt(e.target.getAttribute("data-step"));(P+=t)<0?P=2:P>2&&(P=0),R()}function J(){N=1-N,a("lSound").innerHTML=t[e].sound[N],a("iSound").src="images/"+F[N]}function Z(n){let s=a("iTheme"),i=parseInt(n.target.getAttribute("data-step"));s.children.item(y).classList.remove("active"),(y+=i)<0?y=w.length+M-1:y>w.length+M-1&&(y=0),a("lTheme").innerHTML=t[e].themes_txt[y],s.children.item(y).classList.add("active")}function X(s){let i=a("iCards"),r=parseInt(s.target.getAttribute("data-step"));z+r>=0&&z+r<T.length&&(i.children.item(z).classList.remove("active"),z+=r,a("lCards").innerHTML=T[z]+n+t[e].cards,i.children.item(z).classList.add("active"))}function $(s){let i=a("iPlayers"),r=parseInt(s.target.getAttribute("data-step"));C+r>0&&C+r<6&&(i.children.item(C-1).classList.remove("active"),C+=r,i.children.item(C-1).classList.add("active"),a("lPlayers").innerHTML=1===C?C+n+t[e].player:C+n+t[e].players)}function ee(){let e=.7*Math.sqrt((document.documentElement.clientHeight-40)*document.documentElement.clientWidth/T[z]);g.setAttribute("style","grid-template-columns: repeat(auto-fill, minmax("+e+"px, 1fr))"),document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: wrap;"),a("iStart").getBoundingClientRect().bottom>window.innerHeight&&document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: nowrap;")}function te(n){return function(){!function(n){if(n.classList.contains("turned"))2===L.length&&L.includes(n)&&(L[0].classList.remove("turned"),L[1].classList.remove("turned"),L=[]);else if(2===L.length&&(L[0].classList.remove("turned"),L[1].classList.remove("turned"),L=[]),L.push(n),Q[S]+=1,2===L.length&&(L[0].getElementsByClassName("image")[0].src===L[1].getElementsByClassName("image")[0].src?(b[S]+=1,1===b[S]?a("iMessage").innerHTML=t[e].player+" "+(S+1)+" "+t[e].has+" "+b[S]+" "+t[e].pair+".":a("iMessage").innerHTML=t[e].player+" "+(S+1)+" "+t[e].has+" "+b[S]+" "+t[e].pairs+".",N&&setTimeout(function(){document.getElementById("ding_sound").play()},500),L=[]):((S+=1)===C&&(S=0),a("iMessage").innerHTML=t[e].turn.replace("lPlayer",t[e].player+" "+(S+1)))),n.classList.toggle("turned"),N&&document.getElementById("woosh_sound").play(),g.getElementsByClassName("turned").length===T[z]){if(1===C)c.classList.add("hidden"),a("lWinner").innerHTML=t[e].stats.replace("lCards",T[z]/2).replace("lTries",Q[0]/2);else{const n=document.createElement("tbody");let s,i,r,l="";for(c.classList.remove("hidden"),H=[],c.replaceChild(n,c.getElementsByTagName("tbody")[0]),f=0;f<C;f+=1)H.push({player:f+1,pairs:b[f],tries:Q[f]/2});for(H.sort((e,t)=>t.pairs-e.pairs||e.tries-t.tries),f=0;f<C;f+=1)H[f].rank=f+1,f>0&&H[f-1].pairs===H[f].pairs&&(H[f].rank=H[f-1].rank),1===H[f].rank&&(l+=", "+H[f].player),(i=(s=n.insertRow()).insertCell(0)).innerHTML=H[f].rank,(i=s.insertCell(1)).innerHTML=t[e].player+" "+H[f].player,(i=s.insertCell(2)).innerHTML=H[f].pairs,(i=s.insertCell(3)).innerHTML=H[f].tries;(r=l.lastIndexOf(","))>0?(l=l.substring(2,r)+" "+t[e].and+l.substring(r+1),a("lWinner").innerHTML=t[e].players+" "+l+" "+t[e].win2+" "+H[0].pairs+" "+t[e].pairs2+"."):a("lWinner").innerHTML=t[e].player+" "+H[0].player+" "+t[e].win+" "+H[0].pairs+" "+t[e].pairs2+"."}r.classList.remove("popup-init"),r.classList.remove("popup-hide"),r.classList.add("popup-show")}}(n)}}function ne(){for(k=0,m.classList.add("disabled"),f=0;f<E;f+=1)a("settingsgrid").children.item(f).src.endsWith("images/back.svg")||(k+=1);0===k?a("lOwnImgAnz").innerHTML=t[e].ownanz.replace("lAnz",T[z]/2):T[z]/2-k>1?a("lOwnImgAnz").innerHTML=t[e].ownanz2.replace("lAnz",T[z]/2-k):T[z]/2-k==1?a("lOwnImgAnz").innerHTML=t[e].ownanz3.replace("lAnz","1"):(a("lOwnImgAnz").innerHTML=t[e].ownanz4,m.classList.remove("disabled"))}function ae(e){const t=new FileReader,n=document.createElement("canvas");let a=null;const s=new Image,i={Orientation:void 0};n.id="hiddenCanvas",n.width=500,n.height=500,n.style.visibility="hidden",document.body.appendChild(n),a=n.getContext("2d"),e.target.files[0].type.match("image.*")&&t.readAsDataURL(e.target.files[0]),t.onload=function(){const t=this.result;!function(e,t){let n=new FileReader;n.onload=function(e){let n=new DataView(e.target.result);if(65496!==n.getUint16(0,!1))return t(-2);let a=n.byteLength,s=2;for(;s<a;){if(n.getUint16(s+2,!1)<=8)return t(-1);let e=n.getUint16(s,!1);if(s+=2,65505===e){if(1165519206!==n.getUint32(s+=2,!1))return t(-1);let e=18761===n.getUint16(s+=6,!1);s+=n.getUint32(s+4,e);let a=n.getUint16(s,e);for(s+=2,f=0;f<a;f+=1)if(274===n.getUint16(s+12*f,e))return t(n.getUint16(s+12*f+8,e))}else{if(65280!=(65280&e))break;s+=n.getUint16(s,!1)}}return t(-1)},n.readAsArrayBuffer(e)}(e.target.files[0],function(e){i.Orientation=e,s.src=t})},s.onload=function(){let e=0,t=0,r=Math.min(this.width,this.height);0!==this.width&&0!==this.height&&(_||(5!==i.Orientation&&6!==i.Orientation||(a.rotate(90*Math.PI/180),t=-500),3!==i.Orientation&&4!==i.Orientation||(a.rotate(180*Math.PI/180),t=-504,e=-496),7!==i.Orientation&&8!==i.Orientation||(a.rotate(270*Math.PI/180),e=-500)),a.clearRect(0,0,500,500),a.drawImage(s,this.width/2-r/2,this.height/2-r/2,r,r,e,t,500,500),B.src=n.toDataURL("image/jpeg"),x&&(f=[...B.parentElement.children].indexOf(B),localStorage.setItem("s_memo_image"+f,n.toDataURL("image/jpeg"))),ne())}}function se(){let n=[],s=[];for(g.innerHTML="",b=new Array(C).fill(0),Q=new Array(C).fill(0),S=0,L=[],a("iMessage").innerHTML=t[e].player+" 1 "+t[e].begin,f=0;f<E;f+=1)0===y?a("settingsgrid").children.item(f).src.endsWith("images/back.svg")||n.push(f):n.push(f+1);for(U(n),f=0;f<T[z]/2;f+=1)s.push(n[f]),s.push(n[f]);for(U(s),f=0;f<T[z];f+=1)(p=a("iDummy").getElementsByClassName("flip-container")[0].cloneNode(!0)).getElementsByClassName("image")[0].src=0===y?a("settingsgrid").children.item(s[f]).src:"images/"+w[y]+"/"+s[f]+".jpg",g.appendChild(p);for(f=0;f<h.length;f+=1)h[f].onclick=te(h[f]);ee(),l.classList.remove("swipe-out-right"),o.classList.remove("swipe-in-left"),l.classList.add("swipe-out"),o.classList.add("swipe-in")}function ie(){l.classList.remove("swipe-out"),o.classList.remove("swipe-in"),l.classList.add("swipe-out-right"),o.classList.add("swipe-in-left")}function re(){r.classList.remove("popup-show"),r.classList.add("popup-hide"),setTimeout(function(){ie()},600)}function le(e){let t=new URLSearchParams(window.location.search);return!!t.has(e)&&t.get(e)}function oe(){0===y?(a("collapsable").classList.add("show"),a("iDown").classList.add("rotate"),i.classList.add("play"),W()):se()}window.addEventListener("resize",function(){ee()}),document.addEventListener("fullscreenchange",function(){D()}),document.addEventListener("mozfullscreenchange",function(){D()}),document.addEventListener("webkitfullscreenchange",function(){D()}),document.addEventListener("msfullscreenchange",function(){D()}),function(){const t=(le("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();"de"===t?e=1:"fr"===t?e=2:"es"===t&&(e=3),x&&(N=null===localStorage.getItem("s_memo_sound")?1:parseInt(localStorage.getItem("s_memo_sound")),P=null===localStorage.getItem("s_memo_style")?1:parseInt(localStorage.getItem("s_memo_style")),e=null===localStorage.getItem("s_memo_lang")?e:parseInt(localStorage.getItem("s_memo_lang"))),G(),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),a("iInfo").addEventListener("click",O),a("iInfoClose").addEventListener("click",j),a("iSettings").addEventListener("click",W),a("iSettingsClose").addEventListener("click",q),a("iSettingsCancel").addEventListener("click",q),m.addEventListener("click",q),m.addEventListener("click",se),a("iNextLang").addEventListener("click",Y),a("iPrevLang").addEventListener("click",Y),a("iNextStyle").addEventListener("click",V),a("iPrevStyle").addEventListener("click",V),a("iNextSound").addEventListener("click",J),a("iPrevSound").addEventListener("click",J),a("iNextTheme").addEventListener("click",Z),a("iPrevTheme").addEventListener("click",Z),a("iCardsUp").addEventListener("click",X),a("iCardsDown").addEventListener("click",X),a("iPlayersUp").addEventListener("click",$),a("iPlayersDown").addEventListener("click",$),a("iStart").addEventListener("click",oe),a("iClose").addEventListener("click",ie),a("iOK").addEventListener("click",re),d.addEventListener("click",K),A.addEventListener("click",function(){!function(){const e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,a=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?a.call(e):n.call(t)}()}),a("iShowOwnImg").addEventListener("click",function(){a("collapsable").classList.toggle("show"),a("iDown").classList.toggle("rotate")});try{window.matchMedia("(prefers-color-scheme: light)").addEventListener("change",e=>{I=e.matches,R()})}catch(e){console.log(e.message)}for(I=window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches,R(),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&A.parentNode.removeChild(A),f=1;f<E;f+=1)a("settingsgrid").appendChild(document.getElementsByClassName("ownimg")[0].cloneNode(!0));if("true"===le("mascha")&&(v=2,K()),x)for("true"===localStorage.getItem("s_memo_mascha")&&(M=0),f=0;f<E;f+=1)null!==localStorage.getItem("s_memo_image"+f)&&(a("settingsgrid").children.item(f).src=localStorage.getItem("s_memo_image"+f));document.querySelectorAll("tspan").forEach(function(e){e.innerHTML="grrd's Memo grrd's Memo grrd's Memo grrd's Memo grrd's Memo"}),document.querySelectorAll(".popup-head").forEach(function(e){e.appendChild(document.getElementsByClassName("title1")[0].cloneNode(!0)),e.appendChild(document.getElementsByClassName("title2")[0].cloneNode(!0))}),Array.from(u).forEach(function(e){var t;e.onclick=(t=e,function(){t.classList.toggle("turned")})}),document.getElementById("b_image_input").addEventListener("change",ae,!1),Array.from(document.getElementsByClassName("ownimg")).forEach(function(e){var t;e.onclick=(t=e,function(){B=t,a("b_image_input").click()})}),document.querySelectorAll(".popup-head .title2card").forEach(function(e){e.classList.add("turned")}),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},500),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},1e3),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.remove("turned")},1700),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.remove("turned")},1900),setTimeout(function(){document.getElementsByClassName("cardM2")[0].classList.add("turned")},2500),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},3e3),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},3700),setTimeout(function(){document.getElementsByClassName("cardO")[0].classList.add("turned")},4300),function(){const e=new Image;e.onload=function(){_=1===e.naturalWidth},e.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z"}(),ee()}()}();