/**
 * grrd's Memo
 * Copyright (c) 2020 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";let e=0;const n=[{lang:"English",desc:"grrd’s Memo is a HTML5 Game that works offline.",help:"Flip the cards and find the pairs. Is your memory good enough to remember?",themes_txt:["Own Images","Animals","Flowers","Masha"],cards:"Cards",player:"Player",players:"Players",start:"Play",dev:"Developed by Gérard Tyedmers.",look:"Have a look at my other games:",begin:"begins.",has:"has now",and:"and",win:"wins with",win2:"win with",pair:"pair",pairs:"pairs",pairs2:"pairs",tries:"tries",rank:"rank",stats:"lCards pairs revealed in lTries attempts.",turn:"lPlayer 's turn.",own:"Click on a card to choose your image.",ownanz:"lAnz images needed to start the game.",ownanz2:"lAnz more images needed to start the game.",ownanz3:"lAnz more image needed to start the game.",ownanz4:"Press Play to start the game.",cancel:"Cancel"},{lang:"Deutsch",desc:"grrd's Memo ist ein HTML5 Spiel, welches offline funktioniert",help:"Dreh die Karten um und finde die Paare. Ist dein Gedächtnis gut genug?",themes_txt:["Eigene Bilder","Tiere","Blumen","Mascha"],cards:"Karten",player:"Spieler",players:"Spieler",start:"Play",dev:"Entwickelt von Gérard Tyedmers.",look:"Schau dir auch meine anderen Spiele an: ",begin:"beginnt.",has:"hat nun",and:"und",win:"gewinnt mit",win2:"gewinnen mit",pair:"Paar",pairs:"Paare",pairs2:"Paaren",tries:"Versuche",rank:"Rang",stats:"lCards Paare in lTries Versuchen aufgedeckt.",turn:"lPlayer ist am Zug.",own:"Klick auf eine Karte, um dein Bild zu wählen.",ownanz:"Wähle lAnz Bilder, um das Spiel zu beginnen.",ownanz2:"Wähle noch lAnz Bilder, um das Spiel zu beginnen.",ownanz3:"Wähle noch lAnz Bild, um das Spiel zu beginnen.",ownanz4:"Drücke auf Play, um das Spiel zu beginnen.",cancel:"Abbrechen"},{lang:"Français",desc:"grrd's Memo est un jeu en HTML5 qui fonctionne hors ligne.",help:"Retournez les cartes et trouvez les paires. Votre mémoire est-elle assez bonne?",themes_txt:["Images personnelles","Animaux","Fleurs","Mascha"],cards:"Cartes",player:"Joueur",players:"Joueurs",start:"Play",dev:"Développé par Gérard Tyedmers.",look:"Regardez aussi mes autres jeux: ",begin:"commence.",has:"a maintenant",and:"et",win:"gagne avec",win2:"gagnent avec",pair:"paire",pairs:"paires",pairs2:"paires",tries:"Essais",rank:"Rang",stats:"lCards paires révélées en lTries essais.",turn:"Au tour du lPlayer.",own:"Cliquez sur une carte pour choisir votre image.",ownanz:"Sélectionnez lAnz images pour commencer le jeu.",ownanz2:"Sélectionnez lAnz autres images pour commencer le jeu.",ownanz3:"Sélectionnez lAnz autre image pour commencer le jeu.",ownanz4:"Appuyez sur la touche Play pour commencer le jeu.",cancel:"Annuler"},{lang:"Español",desc:"grrd's Memo es un juego HTML5 que funciona fuera de línea.",help:"Voltea las cartas y encuentra los pares. ¿Es tu memoria lo suficientemente buena?",themes_txt:["Imágenes personales","Animales","Flores","Masha"],cards:"Cartas",player:"Jugador",players:"Jugadores",start:"Play",dev:"Desarrollado por Gérard Tyedmers.",look:"Echa un vistazo a mis otros juegos:",begin:"comienza.",has:"tiene ahora",and:"y",win:"gana con",win2:"ganan con",pair:"par",pairs:"pares",pairs2:"pares",tries:"intentos",rank:"rango",stats:"lCards pares revelados en lTries intentos.",turn:"Turno del lPlayer",own:"Haz clic en una carta para elegir tu imagen.",ownanz:"Selecciona lAnz imágenes para iniciar el juego.",ownanz2:"Selecciona lAnz imágenes más para empezar el juego.",ownanz3:"Selecciona lAnz imagen más para empezar el juego.",ownanz4:"Pulsa Play para iniciar el juego.",cancel:"Cancelar"}],t=function(e){return document.getElementById(e)},a=t("iPopupInfo"),s=t("iPopupSettings"),i=t("iPopupScore"),r=t("iTitle"),l=t("iGame"),o=t("tScore"),c=t("lDev"),A=t("iFullscreen"),d=document.getElementsByClassName("title2card"),u=t("grid");let m;const g=u.getElementsByClassName("flip-container");let p,h=[];const f=24,E=["photo","animals","flowers","mascha"];let w=1,L=0,y=-1;const v=[6,12,24,32,48];let M,T,z,B,k=2,C=2,b=[],I=[],Q=[];const S=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function P(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?t("img_fullscreen").src="images/escfullscreen.svg":t("img_fullscreen").src="images/fullscreen.svg"}function H(e){for(p=e.length-1;p>0;p-=1){const n=Math.floor(Math.random()*(p+1));[e[p],e[n]]=[e[n],e[p]]}return e}function F(){a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show")}function G(){a.classList.remove("popup-show"),a.classList.add("popup-hide")}function R(){W(),s.classList.remove("popup-init"),s.classList.remove("popup-hide"),s.classList.add("popup-show")}function N(){s.classList.remove("popup-show"),s.classList.add("popup-hide"),setTimeout(function(){s.classList.remove("play")},600)}function x(){3===(L+=1)&&(y=0,S&&localStorage.setItem("s_mascha","true"))}function D(a){let s=parseInt(a.target.getAttribute("data-step"));(w+=s)<0?w=E.length+y-1:w>E.length+y-1&&(w=0),t("lTheme").innerHTML=n[e].themes_txt[w],t("iTheme").src="images/"+E[w]+".svg"}function O(a){let s=parseInt(a.target.getAttribute("data-step"));k+s>=0&&k+s<v.length&&(k+=s,t("lCards").innerHTML=v[k]+" "+n[e].cards,t("iCards").src="images/cards"+v[k]+".svg")}function j(a){let s=parseInt(a.target.getAttribute("data-step"));C+s>0&&C+s<6&&(C+=s,t("iPlayers").src="images/player"+C+".svg",t("lPlayers").innerHTML=1===C?C+" "+n[e].player:C+" "+n[e].players)}function _(){let e=.7*Math.sqrt((document.documentElement.clientHeight-40)*document.documentElement.clientWidth/v[k]);u.setAttribute("style","grid-template-columns: repeat(auto-fill, minmax("+e+"px, 1fr))"),document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: wrap;"),t("iStart").getBoundingClientRect().bottom>window.innerHeight&&document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: nowrap;")}function U(a){return function(){!function(a){if(a.classList.contains("turned"))2===h.length&&h.includes(a)&&(h[0].classList.remove("turned"),h[1].classList.remove("turned"),h=[]);else if(2===h.length&&(h[0].classList.remove("turned"),h[1].classList.remove("turned"),h=[]),h.push(a),I[M]+=1,2===h.length&&(h[0].getElementsByClassName("image")[0].src===h[1].getElementsByClassName("image")[0].src?(b[M]+=1,1===b[M]?t("iMessage").innerHTML=n[e].player+" "+(M+1)+" "+n[e].has+" "+b[M]+" "+n[e].pair+".":t("iMessage").innerHTML=n[e].player+" "+(M+1)+" "+n[e].has+" "+b[M]+" "+n[e].pairs+".",h=[]):((M+=1)===C&&(M=0),t("iMessage").innerHTML=n[e].turn.replace("lPlayer",n[e].player+" "+(M+1)))),a.classList.toggle("turned"),u.getElementsByClassName("turned").length===v[k]){if(1===C)o.classList.add("hidden"),t("lWinner").innerHTML=n[e].stats.replace("lCards",v[k]/2).replace("lTries",I[0]/2);else{const a=document.createElement("tbody");let s,i,r,l="";for(o.classList.remove("hidden"),Q=[],o.replaceChild(a,o.getElementsByTagName("tbody")[0]),p=0;p<C;p+=1)Q.push({player:p+1,pairs:b[p],tries:I[p]/2});for(Q.sort((e,n)=>n.pairs-e.pairs||e.tries-n.tries),p=0;p<C;p+=1)Q[p].rank=p+1,p>0&&Q[p-1].pairs===Q[p].pairs&&(Q[p].rank=Q[p-1].rank),1===Q[p].rank&&(l+=", "+Q[p].player),(i=(s=a.insertRow()).insertCell(0)).innerHTML=Q[p].rank,(i=s.insertCell(1)).innerHTML=n[e].player+" "+Q[p].player,(i=s.insertCell(2)).innerHTML=Q[p].pairs,(i=s.insertCell(3)).innerHTML=Q[p].tries;(r=l.lastIndexOf(","))>0?(l=l.substring(2,r)+" "+n[e].and+l.substring(r+1),t("lWinner").innerHTML=n[e].players+" "+l+" "+n[e].win2+" "+Q[0].pairs+" "+n[e].pairs2+"."):t("lWinner").innerHTML=n[e].player+" "+Q[0].player+" "+n[e].win+" "+Q[0].pairs+" "+n[e].pairs2+"."}i.classList.remove("popup-init"),i.classList.remove("popup-hide"),i.classList.add("popup-show")}}(a)}}function W(){for(z=0,t("iSettingsPlay").classList.add("disabled"),p=0;p<f;p+=1)t("settingsgrid").children.item(p).src.endsWith("images/back.svg")||(z+=1);0===z?t("lOwnImgAnz").innerHTML=n[e].ownanz.replace("lAnz",v[k]/2):v[k]/2-z>1?t("lOwnImgAnz").innerHTML=n[e].ownanz2.replace("lAnz",v[k]/2-z):v[k]/2-z==1?t("lOwnImgAnz").innerHTML=n[e].ownanz3.replace("lAnz","1"):(t("lOwnImgAnz").innerHTML=n[e].ownanz4,t("iSettingsPlay").classList.remove("disabled"))}function q(e){const n=new FileReader,t=document.createElement("canvas");let a=null;const s=new Image,i={Orientation:void 0};t.id="hiddenCanvas",t.width=500,t.height=500,t.style.visibility="hidden",document.body.appendChild(t),a=t.getContext("2d"),e.target.files[0].type.match("image.*")?n.readAsDataURL(e.target.files[0]):console.log("File is not an image"),n.onload=function(){const n=this.result;EXIF.getData(e.target.files[0],function(){i.Orientation=EXIF.getTag(this,"Orientation"),s.src=n})},s.onload=function(){let e=0,n=0,r=Math.min(this.width,this.height);0===this.width||0===this.height?console.log("Image is empty"):(B||(5!==i.Orientation&&6!==i.Orientation||(a.rotate(90*Math.PI/180),n=-500),3!==i.Orientation&&4!==i.Orientation||(a.rotate(180*Math.PI/180),n=-504,e=-496),7!==i.Orientation&&8!==i.Orientation||(a.rotate(270*Math.PI/180),e=-500)),a.clearRect(0,0,500,500),a.drawImage(s,this.width/2-r/2,this.height/2-r/2,r,r,e,n,500,500),T.src=t.toDataURL("image/jpeg"),S&&(p=[...T.parentElement.children].indexOf(T),localStorage.setItem("s_image"+p,t.toDataURL("image/jpeg"))),W())}}function K(){let a=[],s=[];for(u.innerHTML="",b=new Array(C).fill(0),I=new Array(C).fill(0),M=0,h=[],t("iMessage").innerHTML=n[e].player+" 1 "+n[e].begin,p=0;p<f;p+=1)0===w?t("settingsgrid").children.item(p).src.endsWith("images/back.svg")||a.push(p):a.push(p+1);for(H(a),p=0;p<v[k]/2;p+=1)s.push(a[p]),s.push(a[p]);for(H(s),p=0;p<v[k];p+=1)(m=t("iDummy").getElementsByClassName("flip-container")[0].cloneNode(!0)).getElementsByClassName("image")[0].src=0===w?t("settingsgrid").children.item(s[p]).src:"images/"+E[w]+"/"+s[p]+".jpg",u.appendChild(m);for(p=0;p<g.length;p+=1)g[p].onclick=U(g[p]);_(),r.classList.remove("swipe-out-right"),l.classList.remove("swipe-in-left"),r.classList.add("swipe-out"),l.classList.add("swipe-in")}function Y(){r.classList.remove("swipe-out"),l.classList.remove("swipe-in"),r.classList.add("swipe-out-right"),l.classList.add("swipe-in-left")}function J(){i.classList.remove("popup-show"),i.classList.add("popup-hide"),setTimeout(function(){Y()},600)}function V(e){let n=new URLSearchParams(window.location.search);return!!n.has(e)&&n.get(e)}function Z(){0===w?(s.classList.add("play"),R()):K()}window.addEventListener("resize",function(){_()}),document.addEventListener("fullscreenchange",function(){P()}),document.addEventListener("mozfullscreenchange",function(){P()}),document.addEventListener("webkitfullscreenchange",function(){P()}),document.addEventListener("msfullscreenchange",function(){P()}),function(){const a=(V("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();if("de"===a?e=1:"fr"===a?e=2:"es"===a&&(e=3),e&&document.documentElement.setAttribute("lang",a),t("lTheme").innerHTML=n[e].themes_txt[w],t("lCards").innerHTML=v[k]+" "+n[e].cards,t("lPlayers").innerHTML=C+" "+n[e].players,t("lStart").innerHTML=n[e].start,c.innerHTML=n[e].dev,t("lInstr").innerHTML=n[e].help,t("lLook").innerHTML=n[e].look,t("thRank").innerHTML=n[e].rank,t("thPlayer").innerHTML=n[e].player,t("thPairs").innerHTML=n[e].pairs,t("thTries").innerHTML=n[e].tries,t("lOwnImg").innerHTML=n[e].own,document.querySelector("meta[name='description']").setAttribute("content",n[e].desc),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),t("iInfo").addEventListener("click",F),t("iInfoClose").addEventListener("click",G),t("iSettings").addEventListener("click",R),t("iSettingsClose").addEventListener("click",N),t("iSettingsCancel").addEventListener("click",N),t("iSettingsPlay").addEventListener("click",N),t("iSettingsPlay").addEventListener("click",K),t("iNextTheme").addEventListener("click",D),t("iPrevTheme").addEventListener("click",D),t("iCardsUp").addEventListener("click",O),t("iCardsDown").addEventListener("click",O),t("iPlayersUp").addEventListener("click",j),t("iPlayersDown").addEventListener("click",j),t("iStart").addEventListener("click",Z),t("iClose").addEventListener("click",Y),t("iOK").addEventListener("click",J),c.addEventListener("click",x),A.addEventListener("click",function(){!function(){const e=window.document,n=e.documentElement,t=n.requestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullScreen||n.msRequestFullscreen,a=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?a.call(e):t.call(n)}()}),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&A.parentNode.removeChild(A),"true"===V("mascha")&&(L=2,x()),S)for("true"===localStorage.getItem("s_mascha")&&(y=0),p=0;p<f;p+=1)null!==localStorage.getItem("s_image"+p)&&(t("settingsgrid").children.item(p).src=localStorage.getItem("s_image"+p));document.querySelectorAll("tspan").forEach(function(e){e.innerHTML="grrd's Memo grrd's Memo grrd's Memo grrd's Memo grrd's Memo"}),document.querySelectorAll(".popup-head").forEach(function(e){e.appendChild(document.getElementsByClassName("title1")[0].cloneNode(!0)),e.appendChild(document.getElementsByClassName("title2")[0].cloneNode(!0))}),Array.from(d).forEach(function(e){var n;e.onclick=(n=e,function(){n.classList.toggle("turned")})}),document.getElementById("b_image_input").addEventListener("change",q,!1),Array.from(document.getElementsByClassName("ownimg")).forEach(function(e){var n;e.onclick=(n=e,function(){T=n,t("b_image_input").click()})}),document.querySelectorAll(".popup-head .title2card").forEach(function(e){e.classList.add("turned")}),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},500),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},1e3),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.remove("turned")},1700),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.remove("turned")},1900),setTimeout(function(){document.getElementsByClassName("cardM2")[0].classList.add("turned")},2500),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},3e3),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},3700),setTimeout(function(){document.getElementsByClassName("cardO")[0].classList.add("turned")},4300),B=new Promise((e,n)=>{const t=new Image;t.onload=(()=>{e(1===t.naturalWidth)}),t.onerror=n,t.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z"}),_()}()}();