/**
 * grrd's Memo
 * Copyright (c) 2020 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";let e=0;const t=[{code:"en",lang:"English",style:["Light mode","Dark mode","Automatic"],sound:["Sound: off","Sound: on"],desc:"grrd’s Memo is a HTML5 Game that works offline.",help:"Flip the cards and find the pairs. Is your memory good enough to remember?",themes_txt:["Own Images","Animals","Flowers","Masha"],cards:"Cards",player:"Player",players:"Players",start:"Play",dev:"Developed by Gérard Tyedmers.",look:"Have a look at my other games:",begin:"begins.",has:"has now",and:"and",win:"wins with",win2:"win with",pair:"pair",pairs:"pairs",pairs2:"pairs",tries:"tries",rank:"rank",stats:"lCards pairs revealed in lTries attempts.",turn:"lPlayer 's turn.",own:"Click on a card to choose your image.",ownanz:"lAnz images needed to start the game.",ownanz2:"lAnz more images needed to start the game.",ownanz3:"lAnz more image needed to start the game.",ownanz4:"Press Play to start the game.",cancel:"Cancel"},{code:"de",lang:"Deutsch",style:["Ansicht: Hell","Ansicht: Dunkel","Automatisch"],sound:["Ton: aus","Ton: an"],desc:"grrd's Memo ist ein HTML5 Spiel, welches offline funktioniert",help:"Dreh die Karten um und finde die Paare. Ist dein Gedächtnis gut genug?",themes_txt:["Eigene Bilder","Tiere","Blumen","Mascha"],cards:"Karten",player:"Spieler",players:"Spieler",start:"Play",dev:"Entwickelt von Gérard Tyedmers.",look:"Schau dir auch meine anderen Spiele an: ",begin:"beginnt.",has:"hat nun",and:"und",win:"gewinnt mit",win2:"gewinnen mit",pair:"Paar",pairs:"Paare",pairs2:"Paaren",tries:"Versuche",rank:"Rang",stats:"lCards Paare in lTries Versuchen aufgedeckt.",turn:"lPlayer ist am Zug.",own:"Klick auf eine Karte, um dein Bild zu wählen.",ownanz:"Wähle lAnz Bilder, um das Spiel zu beginnen.",ownanz2:"Wähle noch lAnz Bilder, um das Spiel zu beginnen.",ownanz3:"Wähle noch lAnz Bild, um das Spiel zu beginnen.",ownanz4:"Drücke auf Play, um das Spiel zu beginnen.",cancel:"Abbrechen"},{code:"fr",lang:"Français",style:["Mode claire","Mode sombre","Automatique"],sound:["Son: muet","Son: activé"],desc:"grrd's Memo est un jeu en HTML5 qui fonctionne hors ligne.",help:"Retournez les cartes et trouvez les paires. Votre mémoire est-elle assez bonne?",themes_txt:["Images personnelles","Animaux","Fleurs","Mascha"],cards:"Cartes",player:"Joueur",players:"Joueurs",start:"Play",dev:"Développé par Gérard Tyedmers.",look:"Regardez aussi mes autres jeux: ",begin:"commence.",has:"a maintenant",and:"et",win:"gagne avec",win2:"gagnent avec",pair:"paire",pairs:"paires",pairs2:"paires",tries:"Essais",rank:"Rang",stats:"lCards paires révélées en lTries essais.",turn:"Au tour du lPlayer.",own:"Cliquez sur une carte pour choisir votre image.",ownanz:"Sélectionnez lAnz images pour commencer le jeu.",ownanz2:"Sélectionnez lAnz autres images pour commencer le jeu.",ownanz3:"Sélectionnez lAnz autre image pour commencer le jeu.",ownanz4:"Appuyez sur la touche Play pour commencer le jeu.",cancel:"Annuler"},{code:"es",lang:"Español",style:["Modo de luz","Modo oscuro ","Automático"],sound:["Sonido: mudo","Sonido: en"],desc:"grrd's Memo es un juego HTML5 que funciona fuera de línea.",help:"Voltea las cartas y encuentra los pares. ¿Es tu memoria lo suficientemente buena?",themes_txt:["Imágenes personales","Animales","Flores","Masha"],cards:"Cartas",player:"Jugador",players:"Jugadores",start:"Play",dev:"Desarrollado por Gérard Tyedmers.",look:"Echa un vistazo a mis otros juegos:",begin:"comienza.",has:"tiene ahora",and:"y",win:"gana con",win2:"ganan con",pair:"par",pairs:"pares",pairs2:"pares",tries:"intentos",rank:"rango",stats:"lCards pares revelados en lTries intentos.",turn:"Turno del lPlayer",own:"Haz clic en una carta para elegir tu imagen.",ownanz:"Selecciona lAnz imágenes para iniciar el juego.",ownanz2:"Selecciona lAnz imágenes más para empezar el juego.",ownanz3:"Selecciona lAnz imagen más para empezar el juego.",ownanz4:"Pulsa Play para iniciar el juego.",cancel:"Cancelar"}],n=function(e){return document.getElementById(e)},a=n("iPopupInfo"),s=n("iPopupSettings"),i=n("iPopupScore"),r=n("iTitle"),l=n("iGame"),o=n("tScore"),c=n("lDev"),d=n("iFullscreen"),A=n("iSettingsPlay"),u=document.getElementsByClassName("title2card"),m=n("grid");let g;const p=m.getElementsByClassName("flip-container");let h,f=[];const L=24,w=["photo","animals","flowers","mascha"];let E=1,y=0,v=-1;const M=[6,12,24,32,48];let T,S,B,k,I,z=2,b=2,C=[],Q=[],H=[],P=1,N=1,F=["sound_off.svg","sound_on.svg"];const _=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function x(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?n("img_fullscreen").src="images/escfullscreen.svg":n("img_fullscreen").src="images/fullscreen.svg"}function D(){e&&document.documentElement.setAttribute("lang",t[e].code),n("lLang").innerHTML=t[e].lang,n("lStyle").innerHTML=t[e].style[P],n("lSound").innerHTML=t[e].sound[N],n("iSound").src="images/"+F[N],n("lTheme").innerHTML=t[e].themes_txt[E],n("lCards").innerHTML=M[z]+" "+t[e].cards,n("lPlayers").innerHTML=b+" "+t[e].players,n("lStart").innerHTML=t[e].start,c.innerHTML=t[e].dev,n("lInstr").innerHTML=t[e].help,n("lLook").innerHTML=t[e].look,n("thRank").innerHTML=t[e].rank,n("thPlayer").innerHTML=t[e].player,n("thPairs").innerHTML=t[e].pairs,n("thTries").innerHTML=t[e].tries,n("lOwnImg").innerHTML=t[e].own,n("lOwnImg2").innerHTML=t[e].themes_txt[0],document.querySelector("meta[name='description']").setAttribute("content",t[e].desc)}function G(){n("lStyle").innerHTML=t[e].style[P],0===P||2===P&&I?document.getElementsByTagName("body")[0].classList.add("light"):document.getElementsByTagName("body")[0].classList.remove("light")}function R(e){for(h=e.length-1;h>0;h-=1){const t=Math.floor(Math.random()*(h+1));[e[h],e[t]]=[e[t],e[h]]}return e}function U(){a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show")}function O(){a.classList.remove("popup-show"),a.classList.add("popup-hide")}function j(){te(),s.classList.remove("popup-init"),s.classList.remove("popup-hide"),s.classList.add("popup-show")}function W(){_&&(localStorage.setItem("s_sound",N),localStorage.setItem("s_style",P),localStorage.setItem("s_lang",e)),s.classList.remove("popup-show"),s.classList.add("popup-hide"),setTimeout(function(){s.classList.remove("play")},600)}function q(){3===(y+=1)&&(v=0,_&&localStorage.setItem("s_mascha","true"))}function K(n){let a=parseInt(n.target.getAttribute("data-step"));(e+=a)<0?e=t.length-1:e>t.length-1&&(e=0),D()}function Y(e){let t=parseInt(e.target.getAttribute("data-step"));(P+=t)<0?P=2:P>2&&(P=0),G()}function V(){N=1-N,n("lSound").innerHTML=t[e].sound[N],n("iSound").src="images/"+F[N]}function J(a){let s=n("iTheme"),i=parseInt(a.target.getAttribute("data-step"));s.children.item(E).classList.remove("active"),(E+=i)<0?E=w.length+v-1:E>w.length+v-1&&(E=0),n("lTheme").innerHTML=t[e].themes_txt[E],s.children.item(E).classList.add("active")}function Z(a){let s=n("iCards"),i=parseInt(a.target.getAttribute("data-step"));z+i>=0&&z+i<M.length&&(s.children.item(z).classList.remove("active"),z+=i,n("lCards").innerHTML=M[z]+" "+t[e].cards,s.children.item(z).classList.add("active"))}function X(a){let s=n("iPlayers"),i=parseInt(a.target.getAttribute("data-step"));b+i>0&&b+i<6&&(s.children.item(b-1).classList.remove("active"),b+=i,s.children.item(b-1).classList.add("active"),n("lPlayers").innerHTML=1===b?b+" "+t[e].player:b+" "+t[e].players)}function $(){let e=.7*Math.sqrt((document.documentElement.clientHeight-40)*document.documentElement.clientWidth/M[z]);m.setAttribute("style","grid-template-columns: repeat(auto-fill, minmax("+e+"px, 1fr))"),document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: wrap;"),n("iStart").getBoundingClientRect().bottom>window.innerHeight&&document.getElementsByTagName("header")[0].setAttribute("style","display: flex; flex-wrap: nowrap;")}function ee(a){return function(){!function(a){if(a.classList.contains("turned"))2===f.length&&f.includes(a)&&(f[0].classList.remove("turned"),f[1].classList.remove("turned"),f=[]);else if(2===f.length&&(f[0].classList.remove("turned"),f[1].classList.remove("turned"),f=[]),f.push(a),Q[T]+=1,2===f.length&&(f[0].getElementsByClassName("image")[0].src===f[1].getElementsByClassName("image")[0].src?(C[T]+=1,1===C[T]?n("iMessage").innerHTML=t[e].player+" "+(T+1)+" "+t[e].has+" "+C[T]+" "+t[e].pair+".":n("iMessage").innerHTML=t[e].player+" "+(T+1)+" "+t[e].has+" "+C[T]+" "+t[e].pairs+".",N&&setTimeout(function(){document.getElementById("ding_sound").play()},500),f=[]):((T+=1)===b&&(T=0),n("iMessage").innerHTML=t[e].turn.replace("lPlayer",t[e].player+" "+(T+1)))),a.classList.toggle("turned"),N&&document.getElementById("woosh_sound").play(),m.getElementsByClassName("turned").length===M[z]){if(1===b)o.classList.add("hidden"),n("lWinner").innerHTML=t[e].stats.replace("lCards",M[z]/2).replace("lTries",Q[0]/2);else{const a=document.createElement("tbody");let s,i,r,l="";for(o.classList.remove("hidden"),H=[],o.replaceChild(a,o.getElementsByTagName("tbody")[0]),h=0;h<b;h+=1)H.push({player:h+1,pairs:C[h],tries:Q[h]/2});for(H.sort((e,t)=>t.pairs-e.pairs||e.tries-t.tries),h=0;h<b;h+=1)H[h].rank=h+1,h>0&&H[h-1].pairs===H[h].pairs&&(H[h].rank=H[h-1].rank),1===H[h].rank&&(l+=", "+H[h].player),(i=(s=a.insertRow()).insertCell(0)).innerHTML=H[h].rank,(i=s.insertCell(1)).innerHTML=t[e].player+" "+H[h].player,(i=s.insertCell(2)).innerHTML=H[h].pairs,(i=s.insertCell(3)).innerHTML=H[h].tries;(r=l.lastIndexOf(","))>0?(l=l.substring(2,r)+" "+t[e].and+l.substring(r+1),n("lWinner").innerHTML=t[e].players+" "+l+" "+t[e].win2+" "+H[0].pairs+" "+t[e].pairs2+"."):n("lWinner").innerHTML=t[e].player+" "+H[0].player+" "+t[e].win+" "+H[0].pairs+" "+t[e].pairs2+"."}i.classList.remove("popup-init"),i.classList.remove("popup-hide"),i.classList.add("popup-show")}}(a)}}function te(){for(B=0,A.classList.add("disabled"),h=0;h<L;h+=1)n("settingsgrid").children.item(h).src.endsWith("images/back.svg")||(B+=1);0===B?n("lOwnImgAnz").innerHTML=t[e].ownanz.replace("lAnz",M[z]/2):M[z]/2-B>1?n("lOwnImgAnz").innerHTML=t[e].ownanz2.replace("lAnz",M[z]/2-B):M[z]/2-B==1?n("lOwnImgAnz").innerHTML=t[e].ownanz3.replace("lAnz","1"):(n("lOwnImgAnz").innerHTML=t[e].ownanz4,A.classList.remove("disabled"))}function ne(e){const t=new FileReader,n=document.createElement("canvas");let a=null;const s=new Image,i={Orientation:void 0};n.id="hiddenCanvas",n.width=500,n.height=500,n.style.visibility="hidden",document.body.appendChild(n),a=n.getContext("2d"),e.target.files[0].type.match("image.*")?t.readAsDataURL(e.target.files[0]):console.log("File is not an image"),t.onload=function(){const t=this.result;!function(e,t){let n=new FileReader;n.onload=function(e){let n=new DataView(e.target.result);if(65496!==n.getUint16(0,!1))return t(-2);let a=n.byteLength,s=2;for(;s<a;){if(n.getUint16(s+2,!1)<=8)return t(-1);let e=n.getUint16(s,!1);if(s+=2,65505===e){if(1165519206!==n.getUint32(s+=2,!1))return t(-1);let e=18761===n.getUint16(s+=6,!1);s+=n.getUint32(s+4,e);let a=n.getUint16(s,e);for(s+=2,h=0;h<a;h+=1)if(274===n.getUint16(s+12*h,e))return t(n.getUint16(s+12*h+8,e))}else{if(65280!=(65280&e))break;s+=n.getUint16(s,!1)}}return t(-1)},n.readAsArrayBuffer(e)}(e.target.files[0],function(e){i.Orientation=e,s.src=t})},s.onload=function(){let e=0,t=0,r=Math.min(this.width,this.height);0===this.width||0===this.height?console.log("Image is empty"):(k||(5!==i.Orientation&&6!==i.Orientation||(a.rotate(90*Math.PI/180),t=-500),3!==i.Orientation&&4!==i.Orientation||(a.rotate(180*Math.PI/180),t=-504,e=-496),7!==i.Orientation&&8!==i.Orientation||(a.rotate(270*Math.PI/180),e=-500)),a.clearRect(0,0,500,500),a.drawImage(s,this.width/2-r/2,this.height/2-r/2,r,r,e,t,500,500),S.src=n.toDataURL("image/jpeg"),_&&(h=[...S.parentElement.children].indexOf(S),localStorage.setItem("s_image"+h,n.toDataURL("image/jpeg"))),te())}}function ae(){let a=[],s=[];for(m.innerHTML="",C=new Array(b).fill(0),Q=new Array(b).fill(0),T=0,f=[],n("iMessage").innerHTML=t[e].player+" 1 "+t[e].begin,h=0;h<L;h+=1)0===E?n("settingsgrid").children.item(h).src.endsWith("images/back.svg")||a.push(h):a.push(h+1);for(R(a),h=0;h<M[z]/2;h+=1)s.push(a[h]),s.push(a[h]);for(R(s),h=0;h<M[z];h+=1)(g=n("iDummy").getElementsByClassName("flip-container")[0].cloneNode(!0)).getElementsByClassName("image")[0].src=0===E?n("settingsgrid").children.item(s[h]).src:"images/"+w[E]+"/"+s[h]+".jpg",m.appendChild(g);for(h=0;h<p.length;h+=1)p[h].onclick=ee(p[h]);$(),r.classList.remove("swipe-out-right"),l.classList.remove("swipe-in-left"),r.classList.add("swipe-out"),l.classList.add("swipe-in")}function se(){r.classList.remove("swipe-out"),l.classList.remove("swipe-in"),r.classList.add("swipe-out-right"),l.classList.add("swipe-in-left")}function ie(){i.classList.remove("popup-show"),i.classList.add("popup-hide"),setTimeout(function(){se()},600)}function re(e){let t=new URLSearchParams(window.location.search);return!!t.has(e)&&t.get(e)}function le(){0===E?(n("collapsable").classList.add("show"),n("iDown").classList.remove("rotate"),s.classList.add("play"),j()):ae()}window.addEventListener("resize",function(){$()}),document.addEventListener("fullscreenchange",function(){x()}),document.addEventListener("mozfullscreenchange",function(){x()}),document.addEventListener("webkitfullscreenchange",function(){x()}),document.addEventListener("msfullscreenchange",function(){x()}),function(){const t=(re("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();"de"===t?e=1:"fr"===t?e=2:"es"===t&&(e=3),_&&(N=null===localStorage.getItem("s_sound")?1:parseInt(localStorage.getItem("s_sound")),P=null===localStorage.getItem("s_style")?1:parseInt(localStorage.getItem("s_style")),e=null===localStorage.getItem("s_lang")?e:parseInt(localStorage.getItem("s_lang"))),D(),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),n("iInfo").addEventListener("click",U),n("iInfoClose").addEventListener("click",O),n("iSettings").addEventListener("click",j),n("iSettingsClose").addEventListener("click",W),n("iSettingsCancel").addEventListener("click",W),A.addEventListener("click",W),A.addEventListener("click",ae),n("iNextLang").addEventListener("click",K),n("iPrevLang").addEventListener("click",K),n("iNextStyle").addEventListener("click",Y),n("iPrevStyle").addEventListener("click",Y),n("iNextSound").addEventListener("click",V),n("iPrevSound").addEventListener("click",V),n("iNextTheme").addEventListener("click",J),n("iPrevTheme").addEventListener("click",J),n("iCardsUp").addEventListener("click",Z),n("iCardsDown").addEventListener("click",Z),n("iPlayersUp").addEventListener("click",X),n("iPlayersDown").addEventListener("click",X),n("iStart").addEventListener("click",le),n("iClose").addEventListener("click",se),n("iOK").addEventListener("click",ie),c.addEventListener("click",q),d.addEventListener("click",function(){!function(){const e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,a=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?a.call(e):n.call(t)}()}),n("iShowOwnImg").addEventListener("click",function(){n("collapsable").classList.toggle("show"),n("iDown").classList.toggle("rotate")}),window.matchMedia("(prefers-color-scheme: light)").addEventListener("change",e=>{I=e.matches,G()}),I=window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches,G(),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&d.parentNode.removeChild(d);for(h=1;h<L;h+=1)n("settingsgrid").appendChild(document.getElementsByClassName("ownimg")[0].cloneNode(!0));if("true"===re("mascha")&&(y=2,q()),_)for("true"===localStorage.getItem("s_mascha")&&(v=0),h=0;h<L;h+=1)null!==localStorage.getItem("s_image"+h)&&(n("settingsgrid").children.item(h).src=localStorage.getItem("s_image"+h));document.querySelectorAll("tspan").forEach(function(e){e.innerHTML="grrd's Memo grrd's Memo grrd's Memo grrd's Memo grrd's Memo"}),document.querySelectorAll(".popup-head").forEach(function(e){e.appendChild(document.getElementsByClassName("title1")[0].cloneNode(!0)),e.appendChild(document.getElementsByClassName("title2")[0].cloneNode(!0))}),Array.from(u).forEach(function(e){var t;e.onclick=(t=e,function(){t.classList.toggle("turned")})}),document.getElementById("b_image_input").addEventListener("change",ne,!1),Array.from(document.getElementsByClassName("ownimg")).forEach(function(e){var t;e.onclick=(t=e,function(){S=t,n("b_image_input").click()})}),document.querySelectorAll(".popup-head .title2card").forEach(function(e){e.classList.add("turned")}),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},500),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},1e3),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.remove("turned")},1700),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.remove("turned")},1900),setTimeout(function(){document.getElementsByClassName("cardM2")[0].classList.add("turned")},2500),setTimeout(function(){document.getElementsByClassName("cardM")[0].classList.add("turned")},3e3),setTimeout(function(){document.getElementsByClassName("cardE")[0].classList.add("turned")},3700),setTimeout(function(){document.getElementsByClassName("cardO")[0].classList.add("turned")},4300),k=new Promise((e,t)=>{const n=new Image;n.onload=(()=>{e(1===n.naturalWidth)}),n.onerror=t,n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z"}),$()}()}();